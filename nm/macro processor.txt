1) MACRO PROCESSOR

import java.util.*;
import java.io.*;

class MNTEntry {
    String name;
    int mdtIndex;

    public MNTEntry(String name, int mdtIndex) {
        this.name = name;
        this.mdtIndex = mdtIndex;
    }
}

public class MacroProcessor {

    static List<String> MDT = new ArrayList<>();
    static List<MNTEntry> MNT = new ArrayList<>();

    public static void main(String[] args) throws Exception {

        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));

        System.out.println("Enter input file name (containing MACRO code):");
        String fileName = br.readLine();

        processFile(fileName);

        System.out.println("\n========== MNT (Macro Name Table) ==========");
        for (int i = 0; i < MNT.size(); i++) {
            System.out.println(i + "\t" + MNT.get(i).name + "\t" + MNT.get(i).mdtIndex);
        }

        System.out.println("\n========== MDT (Macro Definition Table) ==========");
        for (int i = 0; i < MDT.size(); i++) {
            System.out.println(i + "\t" + MDT.get(i));
        }
    }

    private static void processFile(String fileName) throws Exception {

        BufferedReader br = new BufferedReader(new FileReader(fileName));
        String line;

        boolean isDefiningMacro = false;
        String macroName = "";
        int mdtPtr = 0;

        while ((line = br.readLine()) != null) {
            String[] parts = line.trim().split("\\s+");

            // Start of macro
            if (parts[0].equalsIgnoreCase("MACRO")) {
                isDefiningMacro = true;
                continue;
            }

            // If defining macro, add to MDT
            if (isDefiningMacro) {

                if (macroName.equals("")) {
                    // First line after MACRO is macro prototype
                    macroName = parts[0];
                    MNT.add(new MNTEntry(macroName, MDT.size()));
                    MDT.add(line);
                } else {
                    MDT.add(line);
                }

                // End of macro definition
                if (parts[0].equalsIgnoreCase("MEND")) {
                    isDefiningMacro = false;
                    macroName = "";
                }
                continue;
            }

            // Outside macro: check for macro invocation
            boolean expanded = expandMacroIfNeeded(line);

            if (!expanded) {
                System.out.println(line); // Normal code line
            }
        }

        br.close();
    }

    private static boolean expandMacroIfNeeded(String line) {

        String[] parts = line.trim().split("\\s+");
        String name = parts[0];

        // Check in MNT
        for (MNTEntry entry : MNT) {
            if (entry.name.equals(name)) {

                List<String> actualArgs = new ArrayList<>();
                if (parts.length > 1) {
                    actualArgs = Arrays.asList(parts[1].split(","));
                }

                // Expand using MDT
                int mdtPtr = entry.mdtIndex + 1;

                while (!MDT.get(mdtPtr).contains("MEND")) {

                    String expanded = MDT.get(mdtPtr);

                    // Replace parameters &1, &2, etc.
                    for (int i = 0; i < actualArgs.size(); i++) {
                        expanded = expanded.replace("&" + (i + 1), actualArgs.get(i));
                    }

                    System.out.println(expanded);
                    mdtPtr++;
                }

                return true;
            }
        }

        return false;
    }
}
