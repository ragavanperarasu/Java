#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int files[50], indexBlock[50], link[50];
char fileName[10][10];
int fileStart[10];
int fileCount = 0;

void contiguous()
{
    int start, length, i, j, k;
    printf("\nEnter starting block and length of file: ");
    scanf("%d%d", &start, &length);

    if (start + length > 50)
    {
        printf("Error: File exceeds disk size!\n");
        return;
    }
    int allocated = 0;
    for (i = start; i < 50; i++)
    {
        if (files[i] == 1)
            allocated = 0;
        else
            allocated++;
        if (allocated == length)
        {
            start = i - length + 1;
            break;
        }
    }

    for (j = start; j < start + length; j++)
        files[j] = 1;

    printf("File allocated from block %d to %d.\n", start, start + length - 1);
}

// ðŸ”¥ Updated Linked Allocation (from your m-unnadi version)
void linked()
{
    int start, length, i, allocated = 0, prev;
    char name[10];

    printf("\nEnter file name: ");
    scanf("%s", name);

    printf("Enter starting block: ");
    scanf("%d", &start);

    if (files[start] == 1)
    {
        printf("Block already allocated!\n");
        return;
    }

    printf("Enter number of blocks: ");
    scanf("%d", &length);

    files[start] = 1;
    prev = start;
    allocated++;

    for (i = 0; i < 50 && allocated < length; i++)
    {
        if (files[i] == 0)
        {
            files[i] = 1;
            link[prev] = i;
            prev = i;
            allocated++;
        }
    }

    link[prev] = -1;

    if (allocated < length)
        printf("Not enough free blocks!\n");
    else
    {
        strcpy(fileName[fileCount], name);
        fileStart[fileCount] = start;
        fileCount++;

        printf("File allocated successfully using linked allocation.\n");
        printf("Linked Blocks for %s: ", name);

        i = start;
        while (i != -1)
        {
            printf("%d -> ", i);
            i = link[i];
        }
        printf("NULL\n");
    }
}

void displayFile()
{
    char name[10];
    int i, found = 0;

    printf("\nEnter file name to display: ");
    scanf("%s", name);

    for (i = 0; i < fileCount; i++)
    {
        if (strcmp(fileName[i], name) == 0)
        {
            int block = fileStart[i];
            printf("Blocks allocated for %s: ", name);
            while (block != -1)
            {
                printf("%d -> ", block);
                block = link[block];
            }
            printf("NULL\n");
            found = 1;
            break;
        }
    }

    if (!found)
        printf("File not found!\n");
}

void indexed()
{
    int ind, i, count, j = 0;
    printf("\nEnter index block: ");
    scanf("%d", &ind);

    if (files[ind] == 1)
    {
        printf("Index block already allocated!\n");
        return;
    }

    files[ind] = 1;
    printf("Enter number of blocks needed for file: ");
    scanf("%d", &count);
    printf("The block numbers are: ");

    for (i = ind + 1; i < 50 && j < count; i++)
    {
        if (files[i] == 0)
        {
            files[i] = 1;
            indexBlock[j] = i;
            j++;
        }
    }

    if (j < count)
        printf("\nNot enough free blocks!\n");
    else
    {
        printf("\nFile allocated using indexed allocation.\n");
        printf("Index Block %d -> ", ind);
        for (i = 0; i < count; i++)
            printf("%d ", indexBlock[i]);
        printf("\n");
    }
}

int main()
{
    int choice, i;
    for (i = 0; i < 50; i++)
    {
        files[i] = 0;
        link[i] = -1;
    }

    printf("File Allocation Methods Simulation\n");

    while (1)
    {
        printf("\n1. Contiguous Allocation");
        printf("\n2. Linked Allocation");
        printf("\n3. Indexed Allocation");
        printf("\n4. Display Linked File Blocks");
        printf("\n5. Exit");
        printf("\nEnter your choice: ");
        scanf("%d", &choice);

        switch (choice)
        {
        case 1:
            contiguous();
            break;
        case 2:
            linked();
            break;
        case 3:
            indexed();
            break;
        case 4:
            displayFile();
            break;
        case 5:
            exit(0);
        default:
            printf("Invalid choice!\n");
        }
    }
}